<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="pkgutils">
<title>Consistency checking with pkgutils â€¢ pkgutils</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Consistency checking with pkgutils">
<meta property="og:description" content="pkgutils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">pkgutils</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/consistency.html">Consistency checking with pkgutils</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bristol-vaccine-centre/pkgutils/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Consistency checking with pkgutils</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bristol-vaccine-centre/pkgutils/blob/HEAD/vignettes/consistency.Rmd" class="external-link"><code>vignettes/consistency.Rmd</code></a></small>
      <div class="d-none name"><code>consistency.Rmd</code></div>
    </div>

    
    
<p><code>pkgutils</code> is primarily designed to support R package
developers by providing functions for handling missing data, consistency
checks, and parametrising per group analyses.</p>
<p>One area where a lot of boiler plate can be avoided is when a
function can take multiple combinations of optional inputs that resolve
to each other, and where one or more variables can be recycled.</p>
<p>This can require complex logic to handle missing values when some but
not all of the parameters are provided and can have inconsistencies if a
user provides all of the components. Similarly providing lists of
different lengths to such functions can cause issues.</p>
<div class="section level2">
<h2 id="toy-example">Toy example<a class="anchor" aria-label="anchor" href="#toy-example"></a>
</h2>
<p>Suppose we are creating a function that does some mechanics</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">newton2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">m</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># ensure parameters provided are the same length</span></span>
<span>  <span class="fu">pkgutils</span><span class="fu">::</span><span class="fu"><a href="../reference/recycle.html">recycle</a></span><span class="op">(</span><span class="va">f</span>,<span class="va">m</span>,<span class="va">a</span><span class="op">)</span></span>
<span>  <span class="co"># ensure parameters f,m and a are numeric and coerce them if not.</span></span>
<span>  <span class="fu">pkgutils</span><span class="fu">::</span><span class="fu"><a href="../reference/check_numeric.html">check_numeric</a></span><span class="op">(</span><span class="va">f</span>,<span class="va">m</span>,<span class="va">a</span><span class="op">)</span></span>
<span>  <span class="co"># fill in missing variables using the relationships given.</span></span>
<span>  <span class="fu">pkgutils</span><span class="fu">::</span><span class="fu"><a href="../reference/resolve_missing.html">resolve_missing</a></span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="va">m</span><span class="op">*</span><span class="va">a</span>,</span>
<span>    a <span class="op">=</span> <span class="va">f</span><span class="op">/</span><span class="va">m</span>,</span>
<span>    m <span class="op">=</span> <span class="va">f</span><span class="op">/</span><span class="va">a</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># do something useful here...</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f<span class="op">=</span><span class="va">f</span>,m<span class="op">=</span><span class="va">m</span>,a<span class="op">=</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Inferring the acceleration, including coercion of <code>f</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton2</span><span class="op">(</span>f<span class="op">=</span><span class="st">"10"</span>,m<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; $f</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $m</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $a</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>Inferring the acceleration, when recycling the mass parameter:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton2</span><span class="op">(</span>f<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, m<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; $f</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $m</span></span>
<span><span class="co">#&gt;  [1] 2 2 2 2 2 2 2 2 2 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $a</span></span>
<span><span class="co">#&gt;  [1] 0.5 1.0 1.5 2.0 2.5 3.0 3.5 4.0 4.5 5.0</span></span></code></pre></div>
<p>A default value for the mass is given in the function. Inferring it
therefore needs the user to provide an explicit NULL value otherwise the
default prevents inference and the constraints fail as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">newton2</span><span class="op">(</span>f<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, a<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : 1) constraint 'f = m * a' is not met.</span></span>
<span><span class="co">#&gt; 2) constraint 'a = f/m' is not met.</span></span>
<span><span class="co">#&gt; 3) constraint 'm = f/a' is not met.</span></span></code></pre></div>
<p>Combining inferring values with specified default values leads to a
slightly counter-intuitive behaviour so this pattern is not recommended.
It is better not to specify both a default value and constraints for
mass.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton2</span><span class="op">(</span>f<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, m<span class="op">=</span><span class="cn">NULL</span>, a<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#&gt; $f</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $m</span></span>
<span><span class="co">#&gt;  [1]  2  4  6  8 10 12 14 16 18 20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $a</span></span>
<span><span class="co">#&gt;  [1] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5</span></span></code></pre></div>
<p>Inferring the force:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton2</span><span class="op">(</span>m<span class="op">=</span><span class="fl">2</span>,a<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; $f</span></span>
<span><span class="co">#&gt;  [1]  2  4  6  8 10 12 14 16 18 20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $m</span></span>
<span><span class="co">#&gt;  [1] 2 2 2 2 2 2 2 2 2 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $a</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
<p>If insufficient information is provided to calculate the remaining
variables an error is thrown:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">newton2</span><span class="op">(</span>m<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : unable to infer missing variable(s): `f`, `a` using:</span></span>
<span><span class="co">#&gt; `f = m * a`</span></span>
<span><span class="co">#&gt; `a = f/m`</span></span>
<span><span class="co">#&gt; `m = f/a`</span></span>
<span><span class="co">#&gt; given known variable(s): `m` in `newton2(m = 2)`</span></span></code></pre></div>
<p>If a default value is given then that is used in the inference if it
is not specified and recycled as needed, but I still think this has the
potential to be confusing:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton2</span><span class="op">(</span>f<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; $f</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $m</span></span>
<span><span class="co">#&gt;  [1] 5 5 5 5 5 5 5 5 5 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $a</span></span>
<span><span class="co">#&gt;  [1] 0.2 0.4 0.6 0.8 1.0 1.2 1.4 1.6 1.8 2.0</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rob Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
